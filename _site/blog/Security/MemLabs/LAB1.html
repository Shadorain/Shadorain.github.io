<!DOCTYPE html> <!-- theme: jekyll-rtd-theme, based on v0.1.8 --> <html class="writer-html5" lang="en-US"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <title>LAB1 : Beginners Luck · Shadohub</title> <!-- meta --> <meta name="description" content="MemLabs Lab 1 : Beginner’s Luck This is the first Lab that we are totally on our own for in this series of challenges so lets get to it! Let’s firs..."> <meta name="author" content="Jordan Ferraris"> <meta name="revised" content="[commit]"> <meta name="generator" content="jekyll-rtd-theme v0.1.8"> <!-- custom meta --> <!-- og --> <meta property="og:title" content="LAB1 : Beginners Luck · Shadohub"> <meta property="og:description" content="MemLabs Lab 1 : Beginner’s Luck This is the first Lab that we are totally on our own for in this series of challenges so lets get to it! Let’s firs..."> <meta property="og:locale" content="en-US"> <meta property="og:url" content="http://localhost:4000/blog/Security/MemLabs/LAB1"> <meta property="og:type" content="article"> <meta property="article:author" content="Jordan Ferraris"> <meta property="article:modified_time" content="2021-01-26T17:19:58-05:00"> <!-- schema --> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Article", "name": "LAB1 : Beginners Luck · Shadohub", "author": "Jordan Ferraris", "url": "http://localhost:4000/blog/Security/MemLabs/LAB1", "dateModified": "2021-01-26T17:19:58-05:00" } </script> <!-- link --> <link rel="canonical" href="http://localhost:4000/blog/Security/MemLabs/LAB1"> <!-- theme --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/css/theme.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/css/rougify/github.css"> <style>.wy-embed-wrap{width:100%;padding:1em 1.5em;font-size:14px;line-height:20px}.wy-embed-wrap .wy-embed{text-align:center;padding:1em;color:#c2c2c2;background:#4e4b4b;border:1px solid #a0a0a0;border-radius:5px}.wy-embed-wrap .wy-embed a{color:#e6e6e6}.wy-embed-wrap .wy-embed img{max-width:100%}p{font-size:15px}footer p{font-size:14px;text-align:center}.fa-angle-double-right{font-size:13px}.rst-versions.shift-up{overflow-y:auto}.wy-nav-side{padding-bottom:3em}.wy-nav-top a{margin-left:-30px}.rst-content ol,.rst-content ul{overflow-x:auto}.rst-content a code.literal{color:#2980b9}.rst-content code,.rst-content div[class^=highlight] pre,.rst-content pre{font-family:monospace;font-size:12px}.copyright-rtd{display:none}.highlighted-box{border:1px solid #f1c40f}#search-results li:last-child{border-bottom:0;padding-bottom:0}@media screen and (max-width: 768px){.wy-nav-content-wrap .wy-nav-content{padding:1em}}@media screen and (max-width: 480px){.wy-breadcrumbs li.wy-breadcrumbs-aside{display:initial}}*{scrollbar-color:#202324 #454a4d}body{color:#bfaee4}.wy-body-for-nav{background:#0e0e11}.wy-nav-content{background:#101019;max-width:1200px}.wy-nav-side{background:#191926}.wy-side-nav-search{background:#5834eb}a{color:#7658ee}a:link{color:#7658ee}a:visited{color:#7658ee}a:hover{color:#1ea69d}hr{border-color:#943d84}.rst-content blockquote{color:#a78fda;border-left-color:#383d3f;padding:0 0 0 1em;border-left:.25em solid #5b5f73;background:rgba(0,0,0,0.3);background:linear-gradient(90deg, rgba(0,0,0,0.7021009087) 0%, rgba(0,0,0,0.5032213569) 70%, transparent 100%)}.rst-content code{box-shadow:0.75px 0.75px 0.75px 0.75px #1b1b29,0.75px 0.75px 0.75px 0.75px rgba(0,0,0,0.1);border-radius:4px;background:#292941;border:1px solid #292941}.rst-content code.literal,.rst-content tt.literal{color:#318c8c;text-shadow:0.2px 0.2px #000000}a.icon.icon-home{color:#d9bff2;font-size:110%}.btn-neutral{background-color:#2f2f4a !important;color:#7658ee !important}.btn-neutral:visited{background-color:#2f2f4a !important;color:#7658ee !important}.btn-neutral:hover{background-color:#39395a !important;color:#1ea69d !important}.btn{background-color:#2f2f4a;color:#7658ee;border-radius:1px;box-shadow:rgba(47,47,74,0.5) 0px 4px 12px 0px;border:1px solid rgba(0,0,0,0.1);padding-bottom:6px}.btn:visited{background-color:#2f2f4a;color:#7658ee;border-radius:1px;box-shadow:unset;border:1px solid rgba(0,0,0,0.1)}.btn:hover{background-color:#39395a;color:#1ea69d;border-radius:1px;box-shadow:rgba(47,47,74,0.5) 0px 2px 6px 0px;border:1px solid rgba(0,0,0,0.1)}.wy-menu-vertical li span.toctree-expand{color:#ff79c6}.wy-menu-vertical li.current>a span.toctree-expand,.wy-menu-vertical li.on a span.toctree-expand{color:#bfaee4;line-height:1.2}.wy-menu-vertical li span.toctree-expand:hover{color:#943d84}.wy-menu-vertical header,.wy-menu-vertical p.caption{color:#bfaee4;font-size:90%}a.reference.internal{font-size:95%}a.reference.internal:hover{color:#7658ee;font-weight:bold}.fa-plus-square-o::before,.wy-menu-vertical li span.toctree-expand::before{content:""}.fa-minus-square-o::before,.wy-menu-vertical li.current>a span.toctree-expand::before,.wy-menu-vertical li.on a span.toctree-expand::before{content:""}.wy-menu-vertical a:hover{background:rgba(0,0,0,0.3);background:linear-gradient(90deg, rgba(0,0,0,0.7021009087) 0%, rgba(0,0,0,0.5032213569) 70%, transparent 100%)}.wy-menu-vertical a:hover span.toctree-expand{color:#55a5d9}.wy-menu-vertical li.toctree-l1.current>a{color:#ff79c6;background:#171723;border:unset}.wy-menu-vertical li.toctree-l1.current>a:hover .toctree-expand{color:#943d84}.wy-menu-vertical li.toctree-l2.current>a,.wy-menu-vertical li.toctree-l2.current li.toctree-l3>a{color:#6272a4;background:#13131d;border:unset}.wy-menu-vertical li.current a{color:#6272a4;background:#13131d;border:unset}.wy-menu-vertical li.current a:hover{color:#6272a4;background:#0f0f17;border:unset}.wy-menu-vertical li.toctree-l2 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l3 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l4 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l5 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l6 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l7 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l8 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l9 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l10 a:hover span.toctree-expand{color:#943d84}.wy-menu-vertical li.toctree-l2 span.toctree-expand{color:#943d84}.wy-side-nav-search input[type="text"]{border-color:#39395a;border-radius:2px;background:#2f2f4a;box-shadow:unset;color:#bfaee4}.rst-content .highlighted{box-shadow:0 0 0 2px #ff79c6;background:#ff79c6;color:#bfaee4}.rst-content div[class^="highlight"],.rst-content pre.literal-block{border:1px solid #383D3F}.rst-content code,.rst-content div[class^="highlight"] pre,.rst-content pre{background:#1c1e1f}.rst-versions{position:unset} </style> <!-- icon --> <link rel="icon" type="image/svg+xml" href="/assets/favicon.ico"> <!-- script --> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/theme.js"></script> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/anchor.min.js"></script> <script> function feedback(type, message) { console.log(`feedback: https://github.com/rundocs/jekyll-rtd-theme/issues?q=${type}+${message}`); } function highlight() { let text = new URL(location.href).searchParams.get("highlight"); let regexp = new RegExp(text, "im"); if (text) { $(".section").find("*").each(function() { if (this.outerHTML.match(regexp)) { $(this).addClass("highlighted-box"); } }); $(".section").find(".highlighted-box").each(function() { if (($(this).find(".highlighted-box").length > 0)) { $(this).removeClass("highlighted-box"); } }); } } function search(data) { let text = new URL(location.href).searchParams.get("q"); let results = []; let regexp = new RegExp(text, "im"); function slice(content, min, max) { return content.slice(min, max).replace(regexp, (match) => `<span class="highlighted">${match}</span>`); } for (page of data) { let [title, content] = [null, null]; try { if (page.title) { title = page.title.match(regexp); } else { if (page.url == "/") { page.title = "Shadohub"; } else { page.title = page.url; } } } catch (e) { feedback("search", e.message); } try { if (page.content) { page.content = $("<div/>").html(page.content).text(); content = page.content.match(regexp); } } catch (e) { feedback("search", e.message); } if (title || content) { let result = [`<a href="${page.url}?highlight=${text}">${page.title}</a>`]; if (content) { let [min, max] = [content.index - 100, content.index + 100]; let [prefix, suffix] = ["...", "..."]; if (min < 0) { prefix = ""; min = 0; } if (max > page.content.length) { suffix = ""; max = page.content.length; } result.push(`<p class="context">${prefix}${slice(page.content ,min, max)}${suffix}</p>`); } results.push(`<li>${result.join("")}</li>`); } } if (results.length > 0 && text.length > 0) { $("#search-results ul.search").html(results.join("")); $("#search-results p.search-summary").html("Search finished, found # page(s) matching the search query.".replace("#", results.length)); } else { $("#search-results ul.search").empty(); $("#search-results p.search-summary").html("Your search did not match any documents, please make sure that all words are spelled correctly!"); } $("#rtd-search-form [name='q']").val(text); $("#search-results h2").html("Search Results"); } function reset() { const link = $(".wy-menu-vertical").find(`[href="${location.pathname}"]`); if (link.length > 0) { $(".wy-menu-vertical .current").removeClass("current"); link.addClass("current"); link.closest("li.toctree-l1").parent().addClass("current"); link.closest("li.toctree-l1").addClass("current"); link.closest("li.toctree-l2").addClass("current"); link.closest("li.toctree-l3").addClass("current"); link.closest("li.toctree-l4").addClass("current"); link.closest("li.toctree-l5").addClass("current"); } } function admonition() { const items = { note: "Note", tip: "Tip", warning: "Warning", danger: "Danger" }; for (let item in items) { let content = $(`.language-${item}`).html(); $(`.language-${item}`).replaceWith(`<div class="admonition ${item}"><p class="admonition-title">${items[item]}</p><p>${content}</p></div>`); } } $(document).ready(function() { if (location.pathname == "/search.html") { $.ajax({ dataType: "json", url: "/pages.json" }) .done(search) .fail((xhr, message) => feedback("search", message)); } admonition(); anchors.add(); highlight(); SphinxRtdTheme.Navigation.reset = reset; SphinxRtdTheme.Navigation.enable(true); }); </script> </head> <body class="wy-body-for-nav"> <div class="wy-grid-for-nav"> <!-- SIDE NAV, TOGGLES ON MOBILE --> <nav data-toggle="wy-nav-shift" class="wy-nav-side"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a href="/" class="icon icon-home"> Shadohub</a> <div role="search"> <form id="rtd-search-form" class="wy-form" action="/search.html" method="get" autocomplete="off"> <input type="text" name="q" placeholder="Search Docs..."> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> <li class="toctree-l1 "> <a class="reference internal " href="/index.html"> Home </a> </li> <li class="toctree-l1 "> <a class="reference internal " href="/about.html"> About </a> </li> </ul> <p class="caption"><span class="caption-text">My Blog</span></p><ul> <li class="toctree-l1"> <a class="reference internal" href="/blog/Assembly/">Assembler</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/CLang/">C Language</a><ul> <li class="toctree-l2 "> <a class="reference internal " href="/blog/CLang/dynam-mem-alloc.html"> Dynamic Memory Allocation </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Emacs/">Emacs</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/HackTheBox/">Hack the Box</a><ul> <li class="toctree-l2 "> <a class="reference internal " href="/blog/HackTheBox/Cat"> Cat </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Haskell/">Haskell</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Latex/">LaTeX</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Linux/">Linux</a><ul> <li class="toctree-l2 "> <a class="reference internal " href="/blog/Linux/hardening.html"> Hardening Linux </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Security/">Security</a><ul> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/MemLabs/">MemLabs</a><ul> <li class="toctree-l3 current"> <a class="reference internal current" href="/blog/Security/MemLabs/LAB1"> LAB1 : Beginners Luck </a> </li></ul> </li> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/Reversing/">Reversing</a><ul></ul> </li> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/Exploiting-LXD/">Exploiting LXD</a><ul></ul> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Vim/">Vim / Neovim</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Window_Managers/">Window Managers</a><ul></ul> </li></ul> </div></div> </nav> <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"> <!-- MOBILE NAV --> <nav class="wy-nav-top" aria-label="top navigation"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="/">Shadohub</a> </nav> <div class="wy-nav-content"> <div class="rst-content"> <div role="navigation" aria-label="breadcrumbs navigation"> <ul class="wy-breadcrumbs"> <li> <a href="/" class="icon icon-home"></a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/blog/">Blog</a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/blog/Security/">Security</a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/blog/Security/MemLabs/">Memlabs</a><i class="fa fa-angle-double-right"></i> </li> <li>LAB1 : Beginners Luck</li></ul> <hr> </div> <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article"> <div itemprop="articleBody"><div class="section"><h1 class="no_toc" id="memlabs-lab-1--beginners-luck">MemLabs Lab 1 : Beginner's Luck</h1> <p>This is the first Lab that we are totally on our own for in this series of challenges so lets get to it! Let's first read our little prompt/hint:</p> <blockquote> <p>“My sister's computer crashed. We were very fortunate to recover this memory dump. Your job is get all her important files from the system. From what we remember, we suddenly saw a black window pop up with some thing being executed. When the crash happened, she was trying to draw something. Thats all we remember from the time of crash.”</p> </blockquote> <p>Ok so it looks like, a command prompt opened right when the system crashed, potential malware? Wonder what that means that “she was trying to draw something”, but this has to be a useful hint.</p> <h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2> <ol id="markdown-toc"> <li><a href="#flag-1" id="markdown-toc-flag-1">Flag 1</a> <ol> <li><a href="#find-profile" id="markdown-toc-find-profile">Find Profile</a></li> <li><a href="#process-list" id="markdown-toc-process-list">Process List</a></li> <li><a href="#command-scan" id="markdown-toc-command-scan">Command Scan</a> <ol> <li><a href="#side-note" id="markdown-toc-side-note">Side Note</a></li> </ol> </li> <li><a href="#check-stdout" id="markdown-toc-check-stdout">Check stdout</a></li> <li><a href="#environment-variables" id="markdown-toc-environment-variables">Environment Variables</a></li> <li><a href="#hash-dump" id="markdown-toc-hash-dump">Hash dump</a></li> </ol> </li> <li><a href="#flag-2" id="markdown-toc-flag-2">Flag 2</a></li> <li><a href="#flag-3" id="markdown-toc-flag-3">Flag 3</a></li> <li><a href="#resources" id="markdown-toc-resources">Resources</a></li> </ol> <hr /> <h2 id="flag-1">Flag 1</h2> <h3 id="find-profile">Find Profile</h3> <p>Lets first get the profile of this device from the memory dump, volatility is the tool we will be using for this Lab and all future ones. To do this run: Note - Don't forget to extract the archive first…</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> MemoryDump_Lab1.raw imageinfo   <span class="c"># we can also run kdgbscan as well</span>
                                  <span class="c"># instead of imageinfo but this enough for now</span>
...
Suggested Profile<span class="o">(</span>s<span class="o">)</span> : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000,
Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418
AS Layer1 : WindowsAMD64PagedMemory <span class="o">(</span>Kernel AS<span class="o">)</span>
...
</pre></div></div> <p>Looking for the profiles that volatility finds, we can test with different suggested ones, but lets just use the first in our commands.</p> <h3 id="process-list">Process List</h3> <p>Now that we have our profile, its time to see what processes are running on this machine, the main ones I'm looking for are <code class="literal">cmd.exe</code> (Windows Command Prompt), <code class="literal">explorer.exe</code> (Internet Explorer) to see if there are any browser cache files, and something to do with drawing, not exactly sure what that will look like yet, maybe <code class="literal">paint.exe</code>? Lets start with using the famous and handy <code class="literal">pslist</code> plugin in volatility:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 pslist
...
0xfffffa8002046960 explorer.exe     604   2016   33   927   1   0 2019-12-11 14:32:25 UTC+0000
0xfffffa8002222780 cmd.exe         1984    604    1    21   1   0 2019-12-11 14:34:54 UTC+0000
0xfffffa80022bab30 mspaint.exe     2424    604    6   128   1   0 2019-12-11 14:35:14 UTC+0000
0xfffffa8000f4c670 explorer.exe    2504   3000   34   825   2   0 2019-12-11 14:37:14 UTC+0000
0xfffffa8001010b30 WinRAR.exe      1512   2504    6   207   2   0 2019-12-11 14:37:23 UTC+0000
0xfffffa8001020b30 SearchProtocol  2868    480    8   279   0   0 2019-12-11 14:37:23 UTC+0000
...
</pre></div></div> <p>This is just a small list of the processes I found most suspicious. There may be more though so we will look back again if we get stuck. For now, we see our suspicious command prompt window (<code class="literal">cmd.exe</code>) that popped up before crashing, and we even found the mspaint (<code class="literal">mspaint.exe</code>) instance as well that the sister was using to draw on. Explorer here is also open in two instances so we will have to look into those as well. WinRar is open too and I don't exactly know why unless it was for extracting malware but that doesnt seem realistic, we can look into that later if we lose our trail with the other more obvious processes.</p> <h3 id="command-scan">Command Scan</h3> <p>Next we should look at the different commands running on our <code class="literal">cmd.exe</code> instance. To do this lets run volatility with the <code class="literal">cmdscan</code> plugin:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 cmdscan
<span class="k">**************************************************</span>
CommandProcess: conhost.exe Pid: 2692
CommandHistory: 0x1fe9c0 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 1 LastAdded: 0 LastDisplayed: 0
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x60
Cmd <span class="c">#0 @ 0x1de3c0: St4G3$1</span>
Cmd <span class="c">#15 @ 0x1c0158:</span>
Cmd <span class="c">#16 @ 0x1fdb30:</span>
<span class="k">**************************************************</span>
CommandProcess: conhost.exe Pid: 2260
CommandHistory: 0x38ea90 Application: DumpIt.exe Flags: Allocated
CommandCount: 0 LastAdded: <span class="nt">-1</span> LastDisplayed: <span class="nt">-1</span>
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x60
Cmd <span class="c">#15 @ 0x350158: 8</span>
Cmd <span class="c">#16 @ 0x38dc00: 8</span>
</pre></div></div> <p>So, here there are two different command processes running, the second is just the tool used to dump the memory for this challenge <code class="literal">DumpIt.exe</code> so we care more about the first one here. <code class="literal">conhost.exe</code> which occured twice in <code class="literal">pslist</code> actually but I didn't list it because it didn't seem suspicious started a command here actually, but I'm not exactly sure yet what it is so we will come back to this potentially later. For now lets take note of that strange command: <code class="literal">St4G3$1</code></p> <h4 id="side-note">Side Note</h4> <p>Just a little side note… I just realized what this means: <code class="literal">St4G3$1</code>. Look a little closer, try replacing the numbers with letters… Yeah that was a hint and I totally missed it earlier, if you noticed it good job!</p> <blockquote> <p>St4G3$1 -&gt; Stage 1</p> </blockquote> <p>That was the hint to tell us we were close to finding stage 1 then! Either way we still got it so lets find Stage 2!</p> <h3 id="check-stdout">Check stdout</h3> <p>Next, I want to check stdout just incase our processes have been writing to it. To do this we will use the <code class="literal">consoles</code> plugin in volatility:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 consoles
<span class="k">**************************************************</span>
ConsoleProcess: conhost.exe Pid: 2692
Console: 0xff756200 CommandHistorySize: 50
HistoryBufferCount: 1 HistoryBufferMax: 4
OriginalTitle: %SystemRoot%<span class="se">\s</span>ystem32<span class="se">\c</span>md.exe
Title: C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\c</span>md.exe - St4G3<span class="nv">$1</span>
AttachedProcess: cmd.exe Pid: 1984 Handle: 0x60
<span class="nt">----</span>
CommandHistory: 0x1fe9c0 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 1 LastAdded: 0 LastDisplayed: 0
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x60
Cmd <span class="c">#0 at 0x1de3c0: St4G3$1</span>
<span class="nt">----</span>
Screen 0x1e0f70 X:80 Y:300
Dump:
Microsoft Windows <span class="o">[</span>Version 6.1.7601]
Copyright <span class="o">(</span>c<span class="o">)</span> 2009 Microsoft Corporation.  All rights reserved.

C:<span class="se">\U</span>sers<span class="se">\S</span>martNet&gt;St4G3<span class="nv">$1</span>
<span class="nv">ZmxhZ3t0aDFzXzFzX3RoM18xc3Rfc3Q0ZzMhIX0</span><span class="o">=</span>
Press any key to <span class="k">continue</span> <span class="nb">.</span> <span class="nb">.</span> <span class="nb">.</span>
<span class="k">**************************************************</span>
</pre></div></div> <p>I cut out the DumpIt part of this output (in case you are wondering), but look-y here! It looks like we have some useful output!! I wonder what that string is it looks like its base64 encoded: <code class="literal">ZmxhZ3t0aDFzXzFzX3RoM18xc3Rfc3Q0ZzMhIX0=</code> so let's try decoding it:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">echo</span> <span class="s2">"ZmxhZ3t0aDFzXzFzX3RoM18xc3Rfc3Q0ZzMhIX0="</span> | <span class="nb">base64</span> <span class="nt">-d</span> -
flag<span class="o">{</span>th1s_1s_th3_1st_st4g3!!<span class="o">}</span>
</pre></div></div> <p>Well! It looks like we got our first flag! Be proud, I know it was simple but its always nice to see those sweet flags, ya know!? Well, we aren't finished yet silly we have two more to figure out! Lets get to some more work!</p> <h3 id="environment-variables">Environment Variables</h3> <p>Why not check if there are any useful or suspicious environment variables! Assuming the sister doesn't use computers much, there might be some made by the malicious actor in this scenario if there is one so lets take a look. To do this let's utilize the handy <code class="literal">envars</code> plugin in volatility to get a nice list:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 envars
</pre></div></div> <p>We may actually have to run this through a pager such as the common GNU <code class="literal">less</code> utility or my favorite, <code class="literal">bat</code>, to be able to digest this massive load of output, or we could possibly grep through it as well for special keywords such as certain processes or strings we've seen before.</p> <p>Doing this, we can see the sisters full name “Alissa Simpson” since it is her \Users\ account. Something suspicious though is the other user that comes up even more frequently which is “SmartNet-PC” but it looks like this is the user using the DumpIt tool so I'm not sure if this is just a rabbit trail. There is though a logfile that repeatedly has shown up though that looks to be in a suspicious directory <code class="literal">C:\BVTBin\Tests\installpackage\csilogfile.log</code>, wonder if we could get our hands on that. For now lets try a different approach though.</p> <h3 id="hash-dump">Hash dump</h3> <p>Lets try getting a hash dump of the passwords on the system currently and try to brute force them. To get the hashes lets use the <code class="literal">hashdump</code> plugin in volatility:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 hasdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SmartNet:1001:aad3b435b51404eeaad3b435b51404ee:4943abb39473a6f32c11301f4987e7e0:::
HomeGroupUser<span class="nv">$:</span>1002:aad3b435b51404eeaad3b435b51404ee:f0fc3d257814e08fea06e63c5762ebd5:::
Alissa Simpson:1003:aad3b435b51404eeaad3b435b51404ee:f4ff64c8baac57d22f22edc681055ba6:::
</pre></div></div> <p>There are quite a few hashes here, I'm quite certain these are NTLM hashes which seems to be common on Windows so lets see first if an online hash search could “reverse” one of these for us.</p> <table class="docutils align-default"> <tbody> <tr> <td>Administrator</td> <td> </td> </tr> <tr> <td>Guest</td> <td> </td> </tr> <tr> <td>SmartNet</td> <td>smartnet123</td> </tr> <tr> <td>HomeGroupUser</td> <td>NotFound</td> </tr> <tr> <td>Alissa Simpson</td> <td>goodmorningindia</td> </tr> </tbody> </table> <p>Well that's saddening, I don't think that any of these are too useful unless we were able to get onto the PC via a shell or physically. But that isn't the scope of memory forensics so we have to find a different method!</p> <hr /> <h2 id="flag-2">Flag 2</h2> <p>So I ran into quite a ditch pretty fast when attempting different methods to find the second flag. Went back to the hint, recalled that there was a crash that occurred so I went through all the different crash plugins but none of them supported our profile that we were using so I dead ended there, tried almost every other plugin as well just trying and seeing if there was any useful or suspicious output, but got nothing. Then I finally ran the <code class="literal">memdump</code> plugin and crashed my entire blackarch VM… I ran out of all harddrive space and that caused some wacky issues. So I wanted to take a small break, but I just realized that I didnt take a look at all at the memdump and that shoot maybe that could actually be useful, because it dumps the current memory of each process (or a process u select which I didn't know you could do at first). Okay rant over, lets get to work.</p> <p>Remember how to get PID's from the running processes? Yep <code class="literal">pslist</code>/<code class="literal">pstree</code>/etc (in volatility) whichever one you want, just get the PID's of the processes that looked useful for us. Let's start with <code class="literal">mspaint.exe</code>: <code class="literal">2424</code>. Be sure not to simply run the <code class="literal">memdump</code> plugin without checking your system free space, it fills up fast. This command will dump <code class="literal">mspaint.exe</code> to our current directory into a <code class="literal">.dmp</code> file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre><span class="c"># `-p` specifies PID, `-D` is dump directory</span>
❱ volatility <span class="nt">-f</span> <span class="k">*</span>.raw <span class="nt">--profile</span> Win7SP1x64 memdump <span class="nt">-p</span> 2424 <span class="nt">-D</span> <span class="nb">.</span>
</pre></div></div> <p>This is when I found this <a href="https://w00tsec.blogspot.com/2015/02/extracting-raw-pictures-from-memory.html">amazing resource</a> Which gave the most brilliant ideas! Think about what we are trying to do… yep! View images essentially, right? So why aren't we using a tool like GIMP to help us out to visualize our memory dump. Let's do that! First we have to <code class="literal">mv</code> (or Rename on Win) our <code class="literal">.dmp</code> file to a <code class="literal">.data</code> or GIMP wont accept it. Next make sure you have GIMP installed and run <code class="literal">gimp 2424.data</code> and it will open two windows, the one we care about for now is the “Load Image from Raw Data” one. And right away switch the “Image Type” to <code class="literal">RGB Alpha</code> so that we can only see the useful data.</p> <p>Don't hit <code class="literal">Open</code> yet, we want to find our hidden text first in this dump then we can do the rest of what we need. So as this link suggests, because mspaint stores its images as BMPs, it most likely will be flipped and upside-down, so that is a start. The issue is we don't exactly know what we are looking for yet, maybe text? Lets start moving around the three main values there, width and height first, then offset (try to avoid the sliders because they increment too fast and will cause GIMP to crash).</p> <p>So for the height, I kept it at around 600-700 just to fill the small window we are given as a preview, we hardly need to scroll but if you would want to vertically scroll through the memory be sure to set that much higher. The width and offset are where it gets confusing. So honestly I've never done this before so I honestly found it fascinating just to hold the up arrow in the width box and I noticed a white line that stretched accross the screen, but as I kept holding the line would fade and a new larger one would show and have like data in it and it eventually became clear that that was written text and at about width of <code class="literal">4305px</code> (assuming it is in pixels),</p> <blockquote> <p>Note: At <code class="literal">3690px</code> the text is pretty visible here as well, but not enough for reading clearly, so I kept holding the up arrow till the second time it got clearer. I finally found what took me hours to find! Some text that looks like complete giberish, but wait! I grabbed my laptop and flipped it over and there it was our pretty little flag. If we want too we can use offset to make it more seemingly clear atleast from my experiments but I'm not exactly sure what it does. Lets hit okay now!</p> </blockquote> <p>In gimp with our image now prepared, lets use some quick tools to make this easy for us. The first is in <code class="literal">Tools -&gt; Transformation Tools -&gt; Rotate</code> or hit <code class="literal">Shift+R</code>. Let's rotate our image 180 degrees. And second, <code class="literal">Tools -&gt; Transformation Tools -&gt; Flip</code> or <code class="literal">Shift+F</code>. With this tool selected just click on the image in the viewer and that should flip it on the y-axis… and lookey here! Is that not our flag!</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre>flag{G00d_BoY_good_girL}
</pre></div></div> <p>Well done we have gotten the second flag… wow this is only an “Easy” rated challenge too, memory forensics is so cool!</p> <hr /> <h2 id="flag-3">Flag 3</h2> <hr /> <h2 id="resources">Resources</h2> <ul> <li><a href="https://github.com/stuxnet999/MemLabs/tree/master/Lab%201">MemLabs: Lab 1</a></li> <li><a href="https://github.com/volatilityfoundation/volatility/wiki/Command-Reference">Volatility Command list</a></li> </ul> </div> </div> </div> <footer><hr><div role="contentinfo" class="copyright"> <p> <i class="fa fa-copyright"></i> Copyright 2020-2021, Jordan Ferraris </p> </div><div role="contentinfo" class="copyright-rtd"> <a href="https://github.com/rundocs/jekyll-rtd-theme">jekyll-rtd-theme</a> </div> </footer> </div> </div> </section> </div><div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Shadohub</span> <span class="fa fa-caret-down"></span> </span> <div class="rst-other-versions"><dl> <dt>GitHub</dt> <dd><a href="#"><i class="fa fa-github"></i> Homepage</a></dd> <dd><a href="#"><i class="fa fa-download"></i> Download</a></dd> <dd><a href="#"><i class="fa fa-question-circle-o"></i> Issues</a></dd> </dl> <dl> <dt>Gems</dt> <dd><a href="https://rubygems.org/gems/jekyll-coffeescript"><i class="fa fa-cog"></i> jekyll-coffeescript</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-commonmark-ghpages"><i class="fa fa-cog"></i> jekyll-commonmark-ghpages</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-gist"><i class="fa fa-cog"></i> jekyll-gist</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-github-metadata"><i class="fa fa-cog"></i> jekyll-github-metadata</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-paginate"><i class="fa fa-cog"></i> jekyll-paginate</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-relative-links"><i class="fa fa-cog"></i> jekyll-relative-links</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-optional-front-matter"><i class="fa fa-cog"></i> jekyll-optional-front-matter</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-readme-index"><i class="fa fa-cog"></i> jekyll-readme-index</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-default-layout"><i class="fa fa-cog"></i> jekyll-default-layout</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-titles-from-headings"><i class="fa fa-cog"></i> jekyll-titles-from-headings</a></dd> </dl> <dl> <dt>Statistics</dt> <dd> <a href="https://github.com/rundocs/analytics" target="_blank"> Total visits: <span id="counter"></span> <i class="fa fa-eye"></i> </a> </dd> </dl> <script> $(document).ready(function() { $.getJSON("https://rundocs-analytics.glitch.me/analytics?host=" + location.host, function(data) { $("#counter").html(data.count); }); }); </script> <hr> <small> <span> Built with <a href="https://jekyllrb.com/">Jekyll</a> using the <a href="https://github.com/rundocs/jekyll-rtd-theme">jekyll-rtd-theme</a> (MIT) </span> </small> </div> </div> <!-- analytics --></body> </html>