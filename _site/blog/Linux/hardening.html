<!DOCTYPE html> <!-- theme: jekyll-rtd-theme, based on v0.1.8 --> <html class="writer-html5" lang="en-US"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <title>Hardening Linux · Shadohub</title> <!-- meta --> <meta name="description" content="Hardening Linux In this post we take a look at: Userspace AppArmor FireJail RKHunter Kernel Custom Security Patches Network Firewall and new DNS Ta..."> <meta name="author" content="Jordan Ferraris"> <meta name="revised" content="[commit]"> <meta name="generator" content="jekyll-rtd-theme v0.1.8"> <!-- custom meta --> <!-- og --> <meta property="og:title" content="Hardening Linux · Shadohub"> <meta property="og:description" content="Hardening Linux In this post we take a look at: Userspace AppArmor FireJail RKHunter Kernel Custom Security Patches Network Firewall and new DNS Ta..."> <meta property="og:locale" content="en-US"> <meta property="og:url" content="http://localhost:4000/blog/Linux/hardening.html"> <meta property="og:type" content="article"> <meta property="article:author" content="Jordan Ferraris"> <meta property="article:modified_time" content="2021-01-26T17:19:58-05:00"> <!-- schema --> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Article", "name": "Hardening Linux · Shadohub", "author": "Jordan Ferraris", "url": "http://localhost:4000/blog/Linux/hardening.html", "dateModified": "2021-01-26T17:19:58-05:00" } </script> <!-- link --> <link rel="canonical" href="http://localhost:4000/blog/Linux/hardening.html"> <!-- theme --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/css/theme.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/css/rougify/github.css"> <style>.wy-embed-wrap{width:100%;padding:1em 1.5em;font-size:14px;line-height:20px}.wy-embed-wrap .wy-embed{text-align:center;padding:1em;color:#c2c2c2;background:#4e4b4b;border:1px solid #a0a0a0;border-radius:5px}.wy-embed-wrap .wy-embed a{color:#e6e6e6}.wy-embed-wrap .wy-embed img{max-width:100%}p{font-size:15px}footer p{font-size:14px;text-align:center}.fa-angle-double-right{font-size:13px}.rst-versions.shift-up{overflow-y:auto}.wy-nav-side{padding-bottom:3em}.wy-nav-top a{margin-left:-30px}.rst-content ol,.rst-content ul{overflow-x:auto}.rst-content a code.literal{color:#2980b9}.rst-content code,.rst-content div[class^=highlight] pre,.rst-content pre{font-family:monospace;font-size:12px}.copyright-rtd{display:none}.highlighted-box{border:1px solid #f1c40f}#search-results li:last-child{border-bottom:0;padding-bottom:0}@media screen and (max-width: 768px){.wy-nav-content-wrap .wy-nav-content{padding:1em}}@media screen and (max-width: 480px){.wy-breadcrumbs li.wy-breadcrumbs-aside{display:initial}}*{scrollbar-color:#202324 #454a4d}body{color:#bfaee4}.wy-body-for-nav{background:#0e0e11}.wy-nav-content{background:#101019;max-width:1200px}.wy-nav-side{background:#191926}.wy-side-nav-search{background:#5834eb}a{color:#7658ee}a:link{color:#7658ee}a:visited{color:#7658ee}a:hover{color:#1ea69d}hr{border-color:#943d84}.rst-content blockquote{color:#a78fda;border-left-color:#383d3f;padding:0 0 0 1em;border-left:.25em solid #5b5f73;background:rgba(0,0,0,0.3);background:linear-gradient(90deg, rgba(0,0,0,0.7021009087) 0%, rgba(0,0,0,0.5032213569) 70%, transparent 100%)}.rst-content code{box-shadow:0.75px 0.75px 0.75px 0.75px #1b1b29,0.75px 0.75px 0.75px 0.75px rgba(0,0,0,0.1);border-radius:4px;background:#292941;border:1px solid #292941}.rst-content code.literal,.rst-content tt.literal{color:#318c8c;text-shadow:0.2px 0.2px #000000}a.icon.icon-home{color:#d9bff2;font-size:110%}.btn-neutral{background-color:#2f2f4a !important;color:#7658ee !important}.btn-neutral:visited{background-color:#2f2f4a !important;color:#7658ee !important}.btn-neutral:hover{background-color:#39395a !important;color:#1ea69d !important}.btn{background-color:#2f2f4a;color:#7658ee;border-radius:1px;box-shadow:rgba(47,47,74,0.5) 0px 4px 12px 0px;border:1px solid rgba(0,0,0,0.1);padding-bottom:6px}.btn:visited{background-color:#2f2f4a;color:#7658ee;border-radius:1px;box-shadow:unset;border:1px solid rgba(0,0,0,0.1)}.btn:hover{background-color:#39395a;color:#1ea69d;border-radius:1px;box-shadow:rgba(47,47,74,0.5) 0px 2px 6px 0px;border:1px solid rgba(0,0,0,0.1)}.wy-menu-vertical li span.toctree-expand{color:#ff79c6}.wy-menu-vertical li.current>a span.toctree-expand,.wy-menu-vertical li.on a span.toctree-expand{color:#bfaee4;line-height:1.2}.wy-menu-vertical li span.toctree-expand:hover{color:#943d84}.wy-menu-vertical header,.wy-menu-vertical p.caption{color:#bfaee4;font-size:90%}a.reference.internal{font-size:95%}a.reference.internal:hover{color:#7658ee;font-weight:bold}.fa-plus-square-o::before,.wy-menu-vertical li span.toctree-expand::before{content:""}.fa-minus-square-o::before,.wy-menu-vertical li.current>a span.toctree-expand::before,.wy-menu-vertical li.on a span.toctree-expand::before{content:""}.wy-menu-vertical a:hover{background:rgba(0,0,0,0.3);background:linear-gradient(90deg, rgba(0,0,0,0.7021009087) 0%, rgba(0,0,0,0.5032213569) 70%, transparent 100%)}.wy-menu-vertical a:hover span.toctree-expand{color:#55a5d9}.wy-menu-vertical li.toctree-l1.current>a{color:#ff79c6;background:#171723;border:unset}.wy-menu-vertical li.toctree-l1.current>a:hover .toctree-expand{color:#943d84}.wy-menu-vertical li.toctree-l2.current>a,.wy-menu-vertical li.toctree-l2.current li.toctree-l3>a{color:#6272a4;background:#13131d;border:unset}.wy-menu-vertical li.current a{color:#6272a4;background:#13131d;border:unset}.wy-menu-vertical li.current a:hover{color:#6272a4;background:#0f0f17;border:unset}.wy-menu-vertical li.toctree-l2 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l3 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l4 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l5 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l6 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l7 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l8 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l9 a:hover span.toctree-expand,.wy-menu-vertical li.toctree-l10 a:hover span.toctree-expand{color:#943d84}.wy-menu-vertical li.toctree-l2 span.toctree-expand{color:#943d84}.wy-side-nav-search input[type="text"]{border-color:#39395a;border-radius:2px;background:#2f2f4a;box-shadow:unset;color:#bfaee4}.rst-content .highlighted{box-shadow:0 0 0 2px #ff79c6;background:#ff79c6;color:#bfaee4}.rst-content div[class^="highlight"],.rst-content pre.literal-block{border:1px solid #383D3F}.rst-content code,.rst-content div[class^="highlight"] pre,.rst-content pre{background:#1c1e1f}.rst-versions{position:unset} </style> <!-- icon --> <link rel="icon" type="image/svg+xml" href="/assets/favicon.ico"> <!-- script --> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/theme.js"></script> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@0.1.8/assets/js/anchor.min.js"></script> <script> function feedback(type, message) { console.log(`feedback: https://github.com/rundocs/jekyll-rtd-theme/issues?q=${type}+${message}`); } function highlight() { let text = new URL(location.href).searchParams.get("highlight"); let regexp = new RegExp(text, "im"); if (text) { $(".section").find("*").each(function() { if (this.outerHTML.match(regexp)) { $(this).addClass("highlighted-box"); } }); $(".section").find(".highlighted-box").each(function() { if (($(this).find(".highlighted-box").length > 0)) { $(this).removeClass("highlighted-box"); } }); } } function search(data) { let text = new URL(location.href).searchParams.get("q"); let results = []; let regexp = new RegExp(text, "im"); function slice(content, min, max) { return content.slice(min, max).replace(regexp, (match) => `<span class="highlighted">${match}</span>`); } for (page of data) { let [title, content] = [null, null]; try { if (page.title) { title = page.title.match(regexp); } else { if (page.url == "/") { page.title = "Shadohub"; } else { page.title = page.url; } } } catch (e) { feedback("search", e.message); } try { if (page.content) { page.content = $("<div/>").html(page.content).text(); content = page.content.match(regexp); } } catch (e) { feedback("search", e.message); } if (title || content) { let result = [`<a href="${page.url}?highlight=${text}">${page.title}</a>`]; if (content) { let [min, max] = [content.index - 100, content.index + 100]; let [prefix, suffix] = ["...", "..."]; if (min < 0) { prefix = ""; min = 0; } if (max > page.content.length) { suffix = ""; max = page.content.length; } result.push(`<p class="context">${prefix}${slice(page.content ,min, max)}${suffix}</p>`); } results.push(`<li>${result.join("")}</li>`); } } if (results.length > 0 && text.length > 0) { $("#search-results ul.search").html(results.join("")); $("#search-results p.search-summary").html("Search finished, found # page(s) matching the search query.".replace("#", results.length)); } else { $("#search-results ul.search").empty(); $("#search-results p.search-summary").html("Your search did not match any documents, please make sure that all words are spelled correctly!"); } $("#rtd-search-form [name='q']").val(text); $("#search-results h2").html("Search Results"); } function reset() { const link = $(".wy-menu-vertical").find(`[href="${location.pathname}"]`); if (link.length > 0) { $(".wy-menu-vertical .current").removeClass("current"); link.addClass("current"); link.closest("li.toctree-l1").parent().addClass("current"); link.closest("li.toctree-l1").addClass("current"); link.closest("li.toctree-l2").addClass("current"); link.closest("li.toctree-l3").addClass("current"); link.closest("li.toctree-l4").addClass("current"); link.closest("li.toctree-l5").addClass("current"); } } function admonition() { const items = { note: "Note", tip: "Tip", warning: "Warning", danger: "Danger" }; for (let item in items) { let content = $(`.language-${item}`).html(); $(`.language-${item}`).replaceWith(`<div class="admonition ${item}"><p class="admonition-title">${items[item]}</p><p>${content}</p></div>`); } } $(document).ready(function() { if (location.pathname == "/search.html") { $.ajax({ dataType: "json", url: "/pages.json" }) .done(search) .fail((xhr, message) => feedback("search", message)); } admonition(); anchors.add(); highlight(); SphinxRtdTheme.Navigation.reset = reset; SphinxRtdTheme.Navigation.enable(true); }); </script> </head> <body class="wy-body-for-nav"> <div class="wy-grid-for-nav"> <!-- SIDE NAV, TOGGLES ON MOBILE --> <nav data-toggle="wy-nav-shift" class="wy-nav-side"> <div class="wy-side-scroll"> <div class="wy-side-nav-search"> <a href="/" class="icon icon-home"> Shadohub</a> <div role="search"> <form id="rtd-search-form" class="wy-form" action="/search.html" method="get" autocomplete="off"> <input type="text" name="q" placeholder="Search Docs..."> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> <li class="toctree-l1 "> <a class="reference internal " href="/index.html"> Home </a> </li> <li class="toctree-l1 "> <a class="reference internal " href="/about.html"> About </a> </li> </ul> <p class="caption"><span class="caption-text">My Blog</span></p><ul> <li class="toctree-l1"> <a class="reference internal" href="/blog/Assembly/">Assembler</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/CLang/">C Language</a><ul> <li class="toctree-l2 "> <a class="reference internal " href="/blog/CLang/dynam-mem-alloc.html"> Dynamic Memory Allocation </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Emacs/">Emacs</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/HackTheBox/">Hack the Box</a><ul> <li class="toctree-l2 "> <a class="reference internal " href="/blog/HackTheBox/Cat"> Cat </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Haskell/">Haskell</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Latex/">LaTeX</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Linux/">Linux</a><ul> <li class="toctree-l2 current"> <a class="reference internal current" href="/blog/Linux/hardening.html"> Hardening Linux </a> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Security/">Security</a><ul> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/MemLabs/">MemLabs</a><ul> <li class="toctree-l3 "> <a class="reference internal " href="/blog/Security/MemLabs/LAB1"> LAB1 : Beginners Luck </a> </li></ul> </li> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/Reversing/">Reversing</a><ul></ul> </li> <li class="toctree-l2"> <a class="reference internal" href="/blog/Security/Exploiting-LXD/">Exploiting LXD</a><ul></ul> </li></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Vim/">Vim / Neovim</a><ul></ul> </li> <li class="toctree-l1"> <a class="reference internal" href="/blog/Window_Managers/">Window Managers</a><ul></ul> </li></ul> </div></div> </nav> <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"> <!-- MOBILE NAV --> <nav class="wy-nav-top" aria-label="top navigation"> <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="/">Shadohub</a> </nav> <div class="wy-nav-content"> <div class="rst-content"> <div role="navigation" aria-label="breadcrumbs navigation"> <ul class="wy-breadcrumbs"> <li> <a href="/" class="icon icon-home"></a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/blog/">Blog</a><i class="fa fa-angle-double-right"></i> </li> <li> <a href="/blog/Linux/">Linux</a><i class="fa fa-angle-double-right"></i> </li> <li>Hardening Linux</li></ul> <hr> </div> <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article"> <div itemprop="articleBody"><div class="section"><h1 class="no_toc" id="hardening-linux">Hardening Linux</h1> <h5 class="no_toc" id="in-this-post-we-take-a-look-at">In this post we take a look at:</h5> <dl class="no_toc"> <dt>Userspace</dt> <dd><a href="#apparmor">AppArmor</a></dd> <dd><a href="#firejail">FireJail</a></dd> <dd><a href="#rkhunter">RKHunter</a></dd> <dt>Kernel</dt> <dd><a href="#patches">Custom Security Patches</a></dd> <dt>Network</dt> <dd><a href="#firewall">Firewall and new DNS</a></dd> </dl> <hr /> <h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2> <ul id="markdown-toc"> <li><a href="#userspace" id="markdown-toc-userspace">Userspace</a></li> <li><a href="#network" id="markdown-toc-network">Network</a></li> <li><a href="#kernel" id="markdown-toc-kernel">Kernel</a></li> </ul> <hr /> <h3 id="userspace">Userspace</h3> <p><strong>The userspace is where all our typical applications will run on our machine, so we definitely need to implement security here.</strong> There are two FOSS (Free and Open Source) pieces of software that I believe are at the top of the list past SELinux for what we need:</p> <ul> <li>AppArmor</li> <li>FireJail<pre class="language-note">To install these, check in your repo what their package names are. On XBPS (Void Linux) they are simply `apparmor` and `firejail`.
</pre></li> </ul> <h4 class="no_toc" id="apparmor">Apparmor</h4> <p>AppArmor is quite self explanatory to set up quite frankly, and honestly the defaults are all you need for a desktop system. Let's first check if it is enabled:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>aa-enabled
Yes
</pre></div></div> <blockquote> <p>If you get an error here then good that just means we have to set it up. If you get Yes, then you can skip this section.</p> </blockquote> <p>First, we have to send some commands to our kernel, the simplest way to do this is via GRUB, if you use a different bootloader skip to <a href="#different-bootloader">Different Bootloader</a>.</p> <h6 class="no_toc" id="grub">GRUB</h6><pre class="language-tip">Use your editor of choice, I prefer and recommend Neovim which is aliased to `vim` on my system, which I will use throughout all blogposts.
</pre><p>To edit our grub kernel commandline, we must go into <code class="literal">/etc/default/grub</code></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>vim /etc/default/grub
</pre></div></div> <p>Find, the line with <code class="literal">GRUB_CMDLINE_LINUX_DEFAULT</code> and at the end we need to add two parameters, <code class="literal">apparmor=1</code> and <code class="literal">security=apparmor</code>.</p> <p>Here is how my <code class="literal">/etc/default/grub</code> file looks. Take note of the last two parameters of <code class="literal">GRUB_CMDLINE_LINUX_DEFAULT</code>.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre><span class="c">#</span>
<span class="c"># Configuration file for GRUB.</span>
<span class="c">#</span>
<span class="nv">GRUB_DEFAULT</span><span class="o">=</span>0
<span class="c">#GRUB_HIDDEN_TIMEOUT=0</span>
<span class="c">#GRUB_HIDDEN_TIMEOUT_QUIET=false</span>
<span class="nv">GRUB_TIMEOUT</span><span class="o">=</span>5
<span class="nv">GRUB_DISTRIBUTOR</span><span class="o">=</span><span class="s2">"Void"</span>
<span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">"loglevel=4 slub_debug=P page_poison=1 net.ifnames=0 apparmor=1 security=apparmor"</span>
<span class="c"># Uncomment to use basic console</span>
<span class="c">#GRUB_TERMINAL_INPUT="console"</span>
<span class="c"># Uncomment to disable graphical terminal</span>
<span class="c">#GRUB_TERMINAL_OUTPUT=console</span>
<span class="c">#GRUB_BACKGROUND=/usr/share/void-artwork/splash.png</span>
<span class="c">#GRUB_GFXMODE=1920x1080x32</span>
<span class="c">#GRUB_DISABLE_LINUX_UUID=true</span>
<span class="c">#GRUB_DISABLE_RECOVERY=true</span>
<span class="c"># Uncomment and set to the desired menu colors.  Used by normal and wallpaper</span>
<span class="c"># modes only.  Entries specified as foreground/background.</span>
<span class="c">#GRUB_COLOR_NORMAL="light-blue/black"</span>
<span class="c">#GRUB_COLOR_HIGHLIGHT="light-cyan/blue"</span>
</pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>update-grub
❱ <span class="nb">sudo </span>shutdown <span class="nt">-r</span> now
</pre></div></div> <p>This will enable the AppArmor module in the kernel from the GRUB bootloader commandline.</p> <h6 class="no_toc" id="different-bootloader">Different Bootloader</h6> <p>There are quite a large number of bootloader's out there so I will only cover grub here in how to do it, but the options are the same.</p> <p>Here is a <a href="https://wiki.archlinux.org/index.php/Kernel_parameters">link</a> on how to send commands to the kernel from different bootloaders. The commands required for AppArmor to run and function are: <code class="literal">apparmor=1</code> and <code class="literal">security=apparmor</code></p> <h5 class="no_toc" id="enable-and-enforce">Enable and Enforce</h5> <p>Now that we have allowed AppArmor from the kernel, its time to Enable and Enforce!</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>aa-enforce /etc/apparmor.d/<span class="k">*</span>
</pre></div></div> <p>This command employs all the default AppArmor settings that are set in <code class="literal">/etc/apparmor.d/</code>.</p> <blockquote> <p>This is an important directory to keep in mind because if there is not a default configuration file for a specific application, then you will need to make your own to begin enforcement of any policies on that specific application.</p> </blockquote> <p>Finally, it is time to set AppArmor to enforce policies.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>vim /etc/default/apparmor
</pre></div></div> <p>Edit the file to look like this: (note you do not need the comments, just the final line)</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre><span class="c"># AppArmor configuration</span>

<span class="c"># Possible options:</span>
<span class="c"># - disable</span>
<span class="c"># - complain</span>
<span class="c"># - enforce</span>
<span class="nv">APPARMOR</span><span class="o">=</span>enforce
</pre></div></div> <p>Save and exit (<code class="literal">ESC :wq</code>)</p> <h5 class="no_toc" id="finish-up">Finish up</h5> <p>Finally all you have to do is first, reboot your system.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>shutdown <span class="nt">-r</span> now
</pre></div></div> <p>During the bootup process watch closely before it displays the login tty or display manager. If setup correctly, there should have been some apparmor messages.</p> <p>But this isn't a reliable way of checking, here are two ways (advice using both) to check if it is running and enforcing policies:</p> <ul> <li><code class="literal">❱ sudo aa-enabled</code> If this displays <code class="literal">Yes</code> then it is active, but this isn't enough…</li> <li><code class="literal">❱ sudo apparmor_status | less</code> If this displays a whole list of programs then you are all set!</li> </ul> <p>Congratulations, you now have AppArmor installed into your kernel and enforcing security policies on your system. Not so hard after all! There is definitely a lot more too it though so be sure to go through <code class="literal">/etc/apparmor.d/</code> and add your own application configs.</p> <h4 class="no_toc" id="firejail">FireJail</h4> <p><em>Firejail</em> is a program that essentially <strong>sandboxes</strong> any program that is run with it which means that the program can only access directly what it needs and nothing else. This is an effective security measure because if an attacker for example is able to exploit your web browser or a page, they cannot go very far because the browser itself is locked to only it's needed files.</p> <p><em>FireJail</em> is simple to start using, but there is a lot more to it past what this post will cover. First, install it from your repo (<a href="#userspace">see above</a>).</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ firejail <span class="nt">--seccomp</span> <span class="nt">--nonewprivs</span> <span class="nt">--private-tmp</span> &lt;program&gt;
</pre></div></div> <p>This honestly is the only command I use and it has done a good job so far. In my window manager (xmonad) I have this line prepended in every keybind that opens any program, including my terminal, browser, dmenu, everything.</p> <p>I yet have noticed any performance issues, everything has run smooth and without errors. The only programs I believe this could cause malfunction would be those that dynamically call to different libraries or similar. Give this one a good tryout though, definitely think it to be quite helpful in adding another layer of security.</p> <h4 class="no_toc" id="rkhunter">RKHunter</h4> <p><em>RKHunter</em> stands for RootKit Hunter, and this is an incredible tool that looks for any signs of rootkit infections on your system.</p><pre class="language-danger">A RootKit is a form of malware that gives an attacker continued escalated priviledge access to a computer. These are extremely dangerous and can give the attacker access to everything.
</pre><p>Install this from your repo, the package name should simply be <code class="literal">rkhunter</code>, if not, try <code class="literal">rootkit-hunter</code>. First, before anything else, make sure to update our rkhunter <em>properties database</em>.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ rkhunter <span class="nt">--propupd</span>
</pre></div></div> <p>Now we can run the check on our system.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ rkhunter <span class="nt">--check</span>
</pre></div></div> <p>This will wait for user interaction every few lines to make sure that nothing is missed from it. Be sure to watch the right line for any “Warning” or “Dangerous” signs.</p> <p>Once the check is complete, if there were any suspicious binaries we can look in the log file to see more information:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo cat</span> /var/log/rkhunter.log | less
</pre></div></div> <p>Lastly, to quelch any false Warnings (egrep, fgrep, ldd, and some others) simply set them to be whitelisted in our rkhunter config:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>vim /etc/rkhunter.conf
</pre></div></div> <p>Add these lines to whitelist:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre><span class="nv">SCRIPTWHITELIST</span><span class="o">=</span>/usr/bin/egrep
<span class="nv">SCRIPTWHITELIST</span><span class="o">=</span>/usr/bin/fgrep
<span class="nv">SCRIPTWHITELIST</span><span class="o">=</span>/usr/bin/ldd
</pre></div></div> <p>These are false positives because after the base system has been installed, these binaries are swapped with scripts which sengs a flag to rkhunter, but these are not malicious, unless…</p> <p><em>RKHunter</em> is a simple and very powerful tool to keep a watchful eye on various system binaries. Be sure to use it after installing anything that just didn't seem fully trust worthy.</p> <h3 id="network">Network</h3> <h4 class="no_toc" id="reconfigure-dns">Reconfigure DNS</h4> <p>I personally trust Cloudflare to set my DNS to the most. They run <code class="literal">nginx</code> for their server which is under a <em>BSD</em> Liscence, and they promote Free Software alot. On top of this though, their network practically acts like a large VPN, and come with some nice security protocols as well, some being a Firewall and DDOS protection.</p> <p>Let's set it here:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>vim /etc/resolv.conf
</pre></div></div> <p>Depening, your file should be pretty minimal, edit <code class="literal">nameserver &lt;ip&gt;</code> to <code class="literal">nameserver 1.1.1.1</code> (Cloudflares IP). Your file should look similar to:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>search fios-router.home
nameserver 1.1.1.1
</pre></div></div><pre class="language-warning">If you use NetworkManager, you will need to configure it to not reconfigure your 'resolv.conf' on reboot. To do this, add the line `dns=none` under [main] in /etc/NetworkManager/NetworkManager.conf
</pre><h4 class="no_toc" id="setup-ufw-firewall">Setup UFW Firewall</h4> <p><code class="literal">ufw</code> is an awesome tool. It stands for “uncomplicated firewall” because for real, it isn't that complicated, but there is a load of great features and tools with it.</p> <p>Again, install it from your repo (<a href="#userspace">see above</a>). And its time to turn off everything so be prepared to not have any connection!</p> <p>First, find what your network interface is, I set it to a variable here so that you can simply copy and paste the later commands:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ ip <span class="nb">link</span>   <span class="c"># If wireless, your card may look like i.e. `wlan0` or `wlp0s20f3` </span>
            <span class="c"># If ethernet, your card may look like i.e. `eth0` or `elp0s20f3`</span>
❱ <span class="nv">MY_INTERFACE</span><span class="o">=</span>wlan0    <span class="c"># put your interface instead of `wlan0`</span>
</pre></div></div> <p>To enable <code class="literal">ufw</code> run:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>ufw <span class="nb">enable</span>
</pre></div></div> <p>Here we disallow all traffic, nothing in nothing out:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>ufw default deny incoming
❱ <span class="nb">sudo </span>ufw default deny forwarding
❱ <span class="nb">sudo </span>ufw default deny outgoing
</pre></div></div> <p>Next, we obviously don't want to be completely locked away from the internet, so we set some openings:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>ufw allow out on <span class="nv">$MY_INTERFACE</span> to 1.1.1.1 proto udp port 53 comment <span class="s1">'Allows dns on interface'</span>
❱ <span class="nb">sudo </span>ufw allow out on <span class="nv">$MY_INTERFACE</span> to any proto tcp port 80 comment <span class="s1">'Allows HTTP on interface'</span>
❱ <span class="nb">sudo </span>ufw allow out on <span class="nv">$MY_INTERFACE</span> to any proto tcp port 443 comment <span class="s1">'Allows HTTPS on interface'</span>
</pre></div></div> <ul> <li>We allow only traffic through our current DNS which is Cloudflare in this case (1.1.1.1) on port UDP:53.</li> <li>Then allow all HTTP and HTTPS traffic on TCP:80 and TCP:443.</li> <li>These only apply to our current interface as well, the others are still locked down.</li> <li>Should now be able to go to a webpage.</li> </ul> <p>Finally, we need to enable the <code class="literal">ufw</code> service to start at startup:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre><span class="c"># This command only works with the Runit Init System</span>
❱ <span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/sv/ufw /var/service   <span class="c"># enables at startup</span>
❱ <span class="nb">sudo </span>sv up ufw    <span class="c"># starts service now</span>
</pre></div></div> <p>If you run <em>systemd</em> the command will be along the lines of:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre>❱ <span class="nb">sudo </span>systemctl <span class="nb">enable </span>ufw     <span class="c"># enables at startup</span>
❱ <span class="nb">sudo </span>systemctl start ufw      <span class="c"># starts service now</span>
</pre></div></div> <p>There you have it, your <em>uncomplicated firewall</em> is now setup and enabled at startup. There are many more configuration options, but this is plenty enough for the casual desktop user.</p> <h3 id="kernel">Kernel</h3> <p>Not yet done myself! Coming soon…</p> </div> </div> </div> <footer><hr><div role="contentinfo" class="copyright"> <p> <i class="fa fa-copyright"></i> Copyright 2020-2021, Jordan Ferraris </p> </div><div role="contentinfo" class="copyright-rtd"> <a href="https://github.com/rundocs/jekyll-rtd-theme">jekyll-rtd-theme</a> </div> </footer> </div> </div> </section> </div><div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions"> <span class="rst-current-version" data-toggle="rst-current-version"> <span class="fa fa-book"> Shadohub</span> <span class="fa fa-caret-down"></span> </span> <div class="rst-other-versions"><dl> <dt>GitHub</dt> <dd><a href="#"><i class="fa fa-github"></i> Homepage</a></dd> <dd><a href="#"><i class="fa fa-download"></i> Download</a></dd> <dd><a href="#"><i class="fa fa-question-circle-o"></i> Issues</a></dd> </dl> <dl> <dt>Gems</dt> <dd><a href="https://rubygems.org/gems/jekyll-coffeescript"><i class="fa fa-cog"></i> jekyll-coffeescript</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-commonmark-ghpages"><i class="fa fa-cog"></i> jekyll-commonmark-ghpages</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-gist"><i class="fa fa-cog"></i> jekyll-gist</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-github-metadata"><i class="fa fa-cog"></i> jekyll-github-metadata</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-paginate"><i class="fa fa-cog"></i> jekyll-paginate</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-relative-links"><i class="fa fa-cog"></i> jekyll-relative-links</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-optional-front-matter"><i class="fa fa-cog"></i> jekyll-optional-front-matter</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-readme-index"><i class="fa fa-cog"></i> jekyll-readme-index</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-default-layout"><i class="fa fa-cog"></i> jekyll-default-layout</a></dd> <dd><a href="https://rubygems.org/gems/jekyll-titles-from-headings"><i class="fa fa-cog"></i> jekyll-titles-from-headings</a></dd> </dl> <dl> <dt>Statistics</dt> <dd> <a href="https://github.com/rundocs/analytics" target="_blank"> Total visits: <span id="counter"></span> <i class="fa fa-eye"></i> </a> </dd> </dl> <script> $(document).ready(function() { $.getJSON("https://rundocs-analytics.glitch.me/analytics?host=" + location.host, function(data) { $("#counter").html(data.count); }); }); </script> <hr> <small> <span> Built with <a href="https://jekyllrb.com/">Jekyll</a> using the <a href="https://github.com/rundocs/jekyll-rtd-theme">jekyll-rtd-theme</a> (MIT) </span> </small> </div> </div> <!-- analytics --></body> </html>